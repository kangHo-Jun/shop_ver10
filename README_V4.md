# 영림발주서 자동화 시스템 V4 (Direct Mode)

이 문서는 V4 시스템(웹 직접 연동 방식)의 구조와 사용된 파일들에 대해 설명합니다.

## 🚀 시스템 개요
기존 V3(파일 다운로드 → 처리) 방식과 달리, **Door 사이트에서 직접 데이터를 읽어(Scraping) 메모리 상에서 처리 후 즉시 ERP 업로드**를 수행합니다.

---

## 📂 주요 파일 설명

### 1. 실행 파일 (Entry Points)
사용자가 직접 실행하는 파일입니다.

*   **`run_v4_once.py`** (⭐ 추천)
    *   **용도**: **1회 실행용**. 실행 즉시 Door 사이트를 조회하고, 새로운 내역이 있으면 처리 후 종료됩니다.
    *   **작동**: `v4_auto_server.run_batch_process()` 함수를 직접 호출합니다.
    *   **사용법**: 바탕화면 아이콘 또는 더블 클릭으로 실행.
    
*   **`run_v4_server.bat`**
    *   **용도**: **서버 모드 실행기**. `v4_auto_server.py`를 실행하여 백그라운드 서버를 켭니다.
    *   **기능**: 구글 스프레드시트 등 외부 트리거(`http://localhost:5000/trigger`)를 받을 수 있습니다.

### 2. 핵심 로직 (Core Logic)
시스템의 실제 작동을 담당하는 코드들입니다.

*   **`v4_auto_server.py`**
    *   **역할**: V4의 **메인 컨트롤러**입니다.
    *   **기능**:
        *   Flask 웹 서버 구동 (포트 5000).
        *   `DoorBrowser` 클래스: Avast 브라우저(포트 9333)를 제어하여 Door 사이트 조회.
        *   `v4_history.json` 관리: 중복 처리를 방지하기 위한 기록 관리.
        *   `run_batch_process()`: 전체 자동화 흐름(조회 → 파싱 → 업로드)을 제어.

*   **`local_file_processor.py`**
    *   **역할**: **데이터 파싱(해석)**을 담당합니다.
    *   **기능**: HTML 소스를 받아 거래명세서의 품목, 규격, 수량을 추출하여 정형화된 데이터로 변환합니다. (V3와 공유)

*   **`erp_upload_automation_v1.py`**
    *   **역할**: **ERP 업로드**를 담당합니다.
    *   **기능**: Ecount 로그인, 메뉴 이동, 웹자료올리기 팝업 제어 및 데이터 입력을 수행합니다. 독립적인 Chrome 브라우저를 실행합니다.

### 3. 설정 및 데이터 파일
*   **`v4_history.json`**
    *   **용도**: 처리 완료된 트랜잭션 ID(출하번호) 목록을 저장합니다. 이 파일에 있는 번호는 다시 실행해도 건너뜁니다.
    *   **초기화**: 테스트를 위해 특정 건을 다시 처리하고 싶다면 이 파일을 수정/삭제해야 합니다.

---

## ⚠️ V3 (레거시) 관련
아래 파일들은 파일 기반(V3) 처리를 위해 유지됩니다.
*   **`v3_run_all.py`**: 다운로드 폴더의 파일을 순차적으로 처리하는 구형 실행기입니다.
*   **`login_door_yl.py`**: 발주서 다운로드 전용 스크립트입니다.

## 🔧 문제 해결 가이드
1.  **업로드 창이 안 열릴 때**: `erp_upload_automation_v1.py`가 사용하는 Chrome과 충돌이 없도록, V4 스크래퍼는 포트 9333을 사용합니다.
2.  **중복 처리 문제**: 이미 처리된 건은 스킵됩니다. 강제로 다시 올리려면 `run_v4_server.bat`를 끄고 `v4_history.json`에서 해당 번호를 지우세요.
